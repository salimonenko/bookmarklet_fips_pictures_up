javascript:(function (){ var imgs = document.getElementsByTagName('img'); var img_arR = Array.prototype.slice.call(imgs, 1); var parent, jMAX; for (var i=0; i < imgs.length; i++){ var j = 0; jMAX = 50; parent = imgs[i].parentNode; while((parent.nodeName.toLowerCase() !== 'a') && (j++ < jMAX)){ parent = parent.parentNode; if((parent == document.documentElement)){ /* Если ни в одном родителе картинки нет тега а, то удаляем эту картинку из массива картинок */ img_arR.splice(i, 1); break; } } } /* Создаем панель для управления картинками ******************************************************************************* ******* ЗАДАЕМ ПАРАМЕТРЫ (КОНСТАНТЫ) СКРИПТА) *****************************/ var panel = document.createElement('div'); panel.style.height = '95vh'; panel.style.maxWidth = '70%'; var panelminWidth = panel.style.minWidth = '20%'; panel.style.backgroundColor = '#5EFFD1'; panel.style.position = 'fixed'; panel.style.top = '5px'; panel.style.right = '5px'; panel.style.overflow = 'auto'; document.body.appendChild(panel); /* Кнопка для развертывания/свертывания панели */ var close_open = document.createElement('button'); close_open.innerHTML = "?"; close_open.style.fontSize = '16px'; close_open.style.position = 'fixed'; close_open.style.top = '3px'; close_open.style.right = '3px'; close_open.title = 'Свернуть'; close_open.onclick = function () { Fclose_open(panel, close_open, panelminWidth)}; panel.appendChild(close_open); /* Удаляем из массива img_arR все картинки, которые находятся ДО якоря Определяем положение этого якоря на странице */ var a = document.getElementsByTagName('a'); var a_DrStart; for(i = 0; i < a.length; i++){ var a_href_DrStart = /DrStart/; if(a[i].href.match(a_href_DrStart)){ a_DrStart = a[i]; break; } } if(!img_arR.length){ alert('По-видимому, на данной странице этого сайта нет картинок, расположенных внизу страницы. Выполнение запрошенного вами действия прекращено.'); return; } if(i === a.length){ /* Если этот якорь не найден, то, стало быть, поменялся исходный код страниц сайта www1.fips.ru */ alert('В исходном коде этой вебстраницы, к сожалению, не найден тег\n\n \n\n'+ 'Причина: этот сайт модернизирован. \nПоэтому перенос картинок, расположенных внизу этой страницы, в верхнюю правую ее часть невозможен. \nДля восстановления работоспособности скрипта, позволяющего это сделать, обратитесь к его разработчику.'); return; } var a_DrStart_height = getOffsetRect(a[i]).top; /* Положение якоря на странице */ /* Накапливаем в массиве img_arR_needed те элементы массива img_arR, теги картинки, соответствующие которым, находятся на странице ниже якоря */ var img_arR_needed = []; for(i = 0; i < img_arR.length; i++){ if(getOffsetRect(img_arR[i]).top >= a_DrStart_height){ img_arR_needed.push(img_arR[i]); } } /* Добавляем накопленные картинки на панель */ for(i = 0; i < img_arR_needed.length; i++){ img_arR_needed[i].style.display = 'block'; img_arR_needed[i].style.maxHeight = '100%'; img_arR_needed[i].style.width = ''; img_arR_needed[i].style.margin = '2px 10px'; panel.appendChild(img_arR_needed[i]); } /*************** ФУНКЦИИ **************************/ /* Функция определяет координаты элемента на странице */ function getOffsetRect(elem) { var box = elem.getBoundingClientRect(); var body = document.body; var docElem = document.documentElement; var scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop; var scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft; var clientTop = docElem.clientTop || body.clientTop || 0; var clientLeft = docElem.clientLeft || body.clientLeft || 0; var top = box.top + scrollTop - clientTop; var left = box.left + scrollLeft - clientLeft; return { top: Math.round(top), left: Math.round(left) } } /* Функция разворачивает/сворачивает панель с картинками, имеющимися на странице */ function Fclose_open(panel, close_open, panelminWidth) { panelminWidth = parseInt(getComputedStyle(document.body).width)*parseFloat(panelminWidth) / 100; var close_open_minWidth = parseInt(getComputedStyle(close_open).width); var panelWidth = parseInt(getComputedStyle(panel).width); if(panelWidth > close_open_minWidth + 5){ close_open.innerHTML = '-'; close_open.title = 'Развернуть'; close_open_minWidth = parseInt(getComputedStyle(close_open).width); panel.style.width = close_open_minWidth + 5 + 'px'; panel.style.minWidth = ''; }else { close_open.innerHTML = '?'; panel.style.minWidth = panelminWidth + 'px'; panel.style.width = ''; close_open.title = 'Свернуть'; } } })();
